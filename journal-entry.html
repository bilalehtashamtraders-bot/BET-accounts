<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>General Journal Entry - Bilal Ehtasham Traders</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            color: #333;
        }
        .container {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            border: 1px solid #ccc;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #003366;
            padding-bottom: 10px;
        }
        .header h1 {
            font-size: 24px;
            margin: 0;
            color: #003366;
        }
        .entry-details {
            margin-bottom: 20px;
        }
        .entry-details div {
            margin-bottom: 10px;
        }
        .entry-details label {
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
        }
        .entry-details input, .entry-details select {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
            border: 1px solid #ccc;
        }
        .entry-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        .entry-table th, .entry-table td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: left;
        }
        .entry-table input, .entry-table select {
            width: 95%;
            border: none;
        }
        .entry-table .debit, .entry-table .credit {
            width: 100px;
        }
        .add-row {
            cursor: pointer;
            text-align: center;
            font-weight: bold;
            padding: 10px;
        }
        .button-section {
            text-align: center;
        }
        .button-section button {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #003366;
            color: white;
            border: none;
        }
        #balance-check {
            text-align: right;
            font-weight: bold;
            margin-bottom: 15px;
            color: red;
        }
        #balance-check.balanced {
            color: green;
        }
    </style>
</head>
<body>
    <script src="data.js"></script>
    <div class="container">
        <div class="header">
            <h1>General Journal Entry</h1>
        </div>
        <div class="entry-details">
            <div>
                <label for="entryDate">Date:</label>
                <input type="text" id="entryDate" placeholder="DD-MM-YYYY">
            </div>
            <div>
                <label for="description">Description:</label>
                <input type="text" id="description" placeholder="Brief description of the transaction">
            </div>
        </div>
        
        <table class="entry-table">
            <thead>
                <tr>
                    <th>Account</th>
                    <th>Debit</th>
                    <th>Credit</th>
                </tr>
            </thead>
            <tbody id="entry-body">
                <tr>
                    <td>
                        <select onchange="updateAccountType(this)">
                            <option value="Cash">Cash</option>
                            <option value="Bank">Bank</option>
                            <option value="Revenue">Revenue</option>
                            <option value="Expense">Expense</option>
                        </select>
                    </td>
                    <td><input type="number" class="debit" value="0" oninput="calculateBalance()"></td>
                    <td><input type="number" class="credit" value="0" oninput="calculateBalance()"></td>
                </tr>
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="3" class="add-row" onclick="addRow()">+ Add a new entry</td>
                </tr>
            </tfoot>
        </table>
        
        <div id="balance-check">Not Balanced</div>
        <div class="button-section">
            <button onclick="saveJournalEntry()">Save Entry</button>
        </div>
    </div>

    <script>
        let currentAccountTypes = ['Cash'];

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('entryDate').value = new Date().toLocaleDateString('en-GB');
        });

        function addRow() {
            const tableBody = document.getElementById('entry-body');
            const newRow = tableBody.insertRow();
            newRow.innerHTML = `
                <td>
                    <select onchange="updateAccountType(this)">
                        <option value="Cash">Cash</option>
                        <option value="Bank">Bank</option>
                        <option value="Revenue">Revenue</option>
                        <option value="Expense">Expense</option>
                    </select>
                </td>
                <td><input type="number" class="debit" value="0" oninput="calculateBalance()"></td>
                <td><input type="number" class="credit" value="0" oninput="calculateBalance()"></td>
            `;
            updateAccountTypes();
        }

        function calculateBalance() {
            let totalDebit = 0;
            let totalCredit = 0;
            
            document.querySelectorAll('#entry-body .debit').forEach(input => {
                totalDebit += parseFloat(input.value) || 0;
            });

            document.querySelectorAll('#entry-body .credit').forEach(input => {
                totalCredit += parseFloat(input.value) || 0;
            });

            const balanceCheck = document.getElementById('balance-check');
            if (totalDebit === totalCredit) {
                balanceCheck.textContent = 'Balanced';
                balanceCheck.classList.add('balanced');
            } else {
                balanceCheck.textContent = 'Not Balanced';
                balanceCheck.classList.remove('balanced');
            }
        }

        function saveJournalEntry() {
            const entryDate = document.getElementById('entryDate').value;
            const description = document.getElementById('description').value;
            let isBalanced = false;

            let totalDebit = 0;
            let totalCredit = 0;
            
            document.querySelectorAll('#entry-body .debit').forEach(input => {
                totalDebit += parseFloat(input.value) || 0;
            });

            document.querySelectorAll('#entry-body .credit').forEach(input => {
                totalCredit += parseFloat(input.value) || 0;
            });

            if (totalDebit === totalCredit && totalDebit > 0) {
                isBalanced = true;
            }

            if (!isBalanced) {
                alert('The journal entry is not balanced. Please ensure total debits equal total credits.');
                return;
            }
            
            const entries = document.querySelectorAll('#entry-body tr');
            entries.forEach(row => {
                const account = row.querySelector('select').value;
                const debit = parseFloat(row.querySelector('.debit').value) || 0;
                const credit = parseFloat(row.querySelector('.credit').value) || 0;

                const newLedgerEntry = {
                    date: entryDate,
                    description: description,
                    debit: debit,
                    credit: credit,
                    accountType: account,
                    paymentMethod: 'Journal'
                };
                ledger.push(newLedgerEntry);
            });
            
            // This is the new line of code that saves the data
            saveData();

            alert('Journal entry saved and ledger updated!');
        }
    </script>
</body>
</html>
